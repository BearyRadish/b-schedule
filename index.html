<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BåŒºæ’ç­ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }
        .form-group { margin-bottom: 20px; }
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        .staff-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        .staff-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .staff-item:hover { background: #e8e8e8; }
        .staff-item.selected { background: #667eea; color: white; }
        .staff-item.sick { background: #ffebee; color: #c62828; }
        .staff-item.vacation { background: #fff3e0; color: #ef6c00; }
        .staff-item input { margin-right: 8px; }
        .btn {
            display: inline-block;
            padding: 14px 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            margin-left: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        th {
            background: #667eea;
            color: white;
        }
        .time-slot { font-weight: 600; color: #667eea; }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .badge-duty { background: #e3f2fd; color: #1976d2; }
        .badge-cleaning { background: #e8f5e9; color: #388e3c; }
        .badge-inventory { background: #f3e5f5; color: #7b1fa2; }
        #scheduleOutput { margin-top: 30px; }
        .share-box {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .share-box input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
            font-family: monospace;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
        }
        .tab.active { background: #667eea; color: white; }
        .view { display: none; }
        .view.active { display: block; }
        .schedule-item {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .schedule-time { font-weight: 600; color: #667eea; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¢ BåŒºæ’ç­ç®¡ç†ç³»ç»Ÿ</h1>
            <p>B Zone Staffing Schedule</p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showView('manager')">åº—é•¿æ’ç­</div>
            <div class="tab" onclick="showView('employee')">å‘˜å·¥æŸ¥çœ‹</div>
        </div>

        <!-- Manager View -->
        <div id="managerView" class="view active">
            <div class="card">
                <h2>ğŸ“… åŸºæœ¬ä¿¡æ¯</h2>
                <div class="form-group">
                    <label>æ’ç­æ—¥æœŸ</label>
                    <input type="date" id="scheduleDate" value="2026-02-05">
                </div>
                <div class="form-group">
                    <label>æ—¥æœŸç±»å‹</label>
                    <select id="dayType">
                        <option value="weekday">å·¥ä½œæ—¥ (17äºº)</option>
                        <option value="weekend">å‘¨æœ«/èŠ‚å‡æ—¥ (24äºº)</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ‘¥ äººå‘˜çŠ¶æ€ (ç‚¹å‡»åˆ‡æ¢ï¼šæ­£å¸¸ â†’ ç—…å‡ â†’ ä¼‘å‡)</h2>
                <h4 style="margin-top:15px;">Aç­</h4>
                <div class="staff-grid" id="groupA"></div>
                <h4 style="margin-top:15px;">Bç­</h4>
                <div class="staff-grid" id="groupB"></div>
                <h4 style="margin-top:15px;">Cç­</h4>
                <div class="staff-grid" id="groupC"></div>
                <h4 style="margin-top:15px;">Dç­</h4>
                <div class="staff-grid" id="groupD"></div>
                <h4 style="margin-top:15px;">Eç­</h4>
                <div class="staff-grid" id="groupE"></div>
            </div>

            <div class="card">
                <h2>ğŸ‘” ç®¡ç†å±‚é…ç½®</h2>
                <div class="form-group">
                    <label>æ—©ç­DUTY</label>
                    <select id="morningDuty" onchange="updateEveningOptions()">
                        <option value="é™ˆé›ªè²">é™ˆé›ªè²</option>
                        <option value="å¼ æ™Ÿæ¥">å¼ æ™Ÿæ¥</option>
                        <option value="èµµæ¬£">èµµæ¬£</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ™šç­DUTY</label>
                    <select id="eveningDuty">
                        <option value="èµµæ¬£">èµµæ¬£</option>
                        <option value="é™ˆé›ªè²">é™ˆé›ªè²</option>
                        <option value="å¼ æ™Ÿæ¥">å¼ æ™Ÿæ¥</option>
                    </select>
                </div>
            </div>

            <div class="card" style="text-align:center;">
                <button class="btn" onclick="generate()">ğŸš€ ç”Ÿæˆæ’ç­è¡¨</button>
                <button class="btn btn-secondary" onclick="reset()">é‡ç½®</button>
            </div>

            <div id="scheduleOutput"></div>
        </div>

        <!-- Employee View -->
        <div id="employeeView" class="view">
            <div class="card" style="text-align:center;">
                <h2>ğŸ“± æˆ‘çš„æ’ç­</h2>
                <div class="form-group" style="max-width:300px;margin:30px auto;">
                    <select id="employeeSelect">
                        <option value="">-- é€‰æ‹©æ‚¨çš„å§“å --</option>
                    </select>
                </div>
                <button class="btn" onclick="viewPersonalSchedule()">æŸ¥çœ‹æˆ‘çš„æ’ç­</button>
                <div id="personalSchedule"></div>
            </div>
        </div>
    </div>

    <script>
        // Data
        const staffDB = {
            'Aç­': ['å¼ ä¸€æ˜', 'ç‹æ–Œå¤', 'å¼ ç¨‹ä¿Š', 'å¼ ä¹ƒèŠ', 'æ¨æ—º', 'é™ˆæ³½å®', 'äºçª', 'æ¶‚ä¸½ç²'],
            'Bç­': ['è™ç¨³å½¬', 'å¼ åº·', 'æå˜‰æ¬£', 'éƒ­å˜‰è¯š', 'æœéœ‡', 'ç½—æ™“ç‡•', 'æ²ˆæ˜ç¾½'],
            'Cç­': ['ç‹å³°', 'é™ˆç', 'å‘¨è…¾é£', 'æ²ˆæ€è¾°', 'å¼ ä¸€é¸£'],
            'Dç­': ['ç”˜æ¾', 'é¾šå„’é¦¨', 'æœ±ç››ç¥º', 'é«˜ç‘æ˜‚', 'æä½³éœ–', 'å§šé™å®œ', 'æ´ªç‘¾', 'å¼ æ€å½¤'],
            'Eç­': ['æ¢æ™¯ç„±', 'ç››å®¶è´º', 'å•æ·¼', 'èµµæ€æ¶µ', 'äºæµ©ç„¶']
        };

        const skills = {
            'å¼ ä¸€æ˜': ['OMNI', 'æ‰‹ä½œ', 'ä¸»æœº'],
            'ç‹æ–Œå¤': ['ä¿é¾„çƒ', 'OMNI', 'å°„å‡»'],
            'å¼ ä¹ƒèŠ': ['OMNI', 'æ‰‹ä½œ', 'ä¸»æœº'],
            'é¾šå„’é¦¨': ['OMNI', 'DBOX', 'æ²™ç›˜èµ›è½¦'],
            'ç”˜æ¾': ['ç¿¼è£…é£è¡Œ', 'OMNI', 'æ»‘é›ªæœº'],
            'æœéœ‡': ['çš®åˆ’è‰‡', 'å°„å‡»', 'å°„ç®­'],
            'äºæµ©ç„¶': ['DBOX', 'æ²™ç›˜èµ›è½¦', 'ä¿é¾„çƒ'],
            'å¼ åº·': ['OMNI', 'å°„å‡»', 'çš®åˆ’è‰‡'],
            'æå˜‰æ¬£': ['æ‰‹ä½œ', 'å°„å‡»', 'ä¿é¾„çƒ'],
            'æ¢æ™¯ç„±': ['ä¿é¾„çƒ', 'OMNI', 'é£é•–'],
            'è™ç¨³å½¬': ['ä¿é¾„çƒ', 'æ²™ç›˜èµ›è½¦', 'ç¿¼è£…é£è¡Œ'],
            'ç½—æ™“ç‡•': ['ä¿é¾„çƒ', 'çš®åˆ’è‰‡', 'æ»‘é›ªæœº'],
            'å¼ è¯—æ™—': ['ç¿¼è£…é£è¡Œ', 'æ»‘é›ªæœº', 'å†²æµªæ¿'],
            'é‡‘è¶Š': ['æœºåŠ¨']
        };

        let staffStatus = {};
        let currentSchedule = null;

        // Initialize
        function init() {
            renderStaff();
            populateEmployees();
            updateEveningOptions();
        }

        function renderStaff() {
            Object.keys(staffDB).forEach(group => {
                const container = document.getElementById('group' + group.replace('ç­', ''));
                container.innerHTML = staffDB[group].map(name => `
                    <div class="staff-item selected" data-name="${name}" onclick="toggleStatus('${name}')">
                        <input type="checkbox" checked>
                        <label>${name}</label>
                    </div>
                `).join('');
            });
        }

        function toggleStatus(name) {
            const el = document.querySelector(`[data-name="${name}"]`);
            const checkbox = el.querySelector('input');
            
            // Cycle: normal -> sick -> vacation -> normal
            if (!el.classList.contains('sick') && !el.classList.contains('vacation')) {
                el.classList.remove('selected');
                el.classList.add('sick');
                checkbox.checked = false;
                staffStatus[name] = 'sick';
            } else if (el.classList.contains('sick')) {
                el.classList.remove('sick');
                el.classList.add('vacation');
                checkbox.checked = false;
                staffStatus[name] = 'vacation';
            } else {
                el.classList.remove('vacation');
                el.classList.add('selected');
                checkbox.checked = true;
                staffStatus[name] = 'normal';
            }
        }

        function updateEveningOptions() {
            const morning = document.getElementById('morningDuty').value;
            const evening = document.getElementById('eveningDuty');
            
            Array.from(evening.options).forEach(opt => {
                opt.disabled = (opt.value === morning);
            });
            
            if (evening.value === morning) {
                evening.value = Array.from(evening.options).find(o => !o.disabled).value;
            }
        }

        function generate() {
            try {
                const date = document.getElementById('scheduleDate').value;
                const dayType = document.getElementById('dayType').value;
                const morningDuty = document.getElementById('morningDuty').value;
                const eveningDuty = document.getElementById('eveningDuty').value;

                if (morningDuty === eveningDuty) {
                    alert('æ—©ç­å’Œæ™šç­DUTYä¸èƒ½æ˜¯åŒä¸€ä¸ªäººï¼');
                    return;
                }

                // Get available staff
                const available = [];
                Object.keys(staffDB).forEach(g => {
                    staffDB[g].forEach(name => {
                        if (staffStatus[name] !== 'sick' && staffStatus[name] !== 'vacation') {
                            available.push({name, group: g, skills: skills[name] || ['æœºåŠ¨']});
                        }
                    });
                });

                if (available.length === 0) {
                    alert('æ²¡æœ‰å¯ç”¨çš„å‘˜å·¥ï¼');
                    return;
                }

                // Generate schedule
                currentSchedule = buildSchedule(available, dayType, morningDuty, eveningDuty, date);
                
                // Display
                displaySchedule(currentSchedule);
                
                // Save
                localStorage.setItem('schedule_' + date, JSON.stringify(currentSchedule));
                
            } catch (err) {
                alert('é”™è¯¯: ' + err.message);
                console.error(err);
            }
        }

        function buildSchedule(staff, dayType, morningDuty, eveningDuty, date) {
            const times = ['9:00-10:00', '10:00-11:00', '11:00-12:00', '12:00-13:30', 
                          '13:30-14:30', '14:30-16:00', '16:00-17:00', '17:00-18:00',
                          '18:00-19:00', '19:00-20:00', '20:00-21:00', '21:00-22:00', '22:00-22:30'];
            
            const stations = ['OMNI', 'MF', 'DBOX', 'æ²™ç›˜èµ›è½¦', 'ç¿¼è£…é£è¡Œ', 'ä¿é¾„çƒ', 
                             'é£é•–', 'å°„å‡»', 'å°„ç®­', 'æ»‘é›ªæœº', 'çš®åˆ’è‰‡', 'å†²æµªæ¿', 'ä¸»æœº', 'æ‰‹ä½œ'];
            
            let html = '<div class="card"><h2>ğŸ“‹ æ’ç­è¡¨ - ' + date + '</h2>';
            html += '<p><strong>ç±»å‹:</strong> ' + (dayType === 'weekend' ? 'å‘¨æœ«/èŠ‚å‡æ—¥' : 'å·¥ä½œæ—¥') + ' | ';
            html += '<strong>æ—©ç­DUTY:</strong> <span class="badge badge-duty">' + morningDuty + '</span> | ';
            html += '<strong>æ™šç­DUTY:</strong> <span class="badge badge-duty">' + eveningDuty + '</span></p>';
            html += '<p><strong>æ—©ç­è´Ÿè´£äºº:</strong> é‡‘è¶Š | <strong>æ™šç­è´Ÿè´£äºº:</strong> å¼ è¯—æ™—</p>';
            html += '<p><strong>é¥®æ–™æœºç›˜ç‚¹:</strong> ' + staff[0].name + ' | <strong>å¨ƒå¨ƒæœºç›˜ç‚¹:</strong> ' + (staff[1]?.name || staff[0].name) + '</p>';
            
            html += '<table><thead><tr><th>æ—¶é—´</th><th>ä»»åŠ¡/å²—ä½</th><th>äººå‘˜</th></tr></thead><tbody>';
            
            // Opening
            html += '<tr><td class="time-slot">9:00-10:00</td>';
            html += '<td><span class="badge badge-cleaning">å¼€æ¡£æ¸…æ´</span><br>æ²™ç›˜èµ›è½¦,æ‹ç…§æœº,MF,æ´¾å¯¹æˆ¿</td>';
            html += '<td>' + staff.slice(0, 3).map(s => s.name).join(', ') + '</td></tr>';
            
            // Main shifts
            for (let i = 1; i < times.length - 1; i++) {
                const time = times[i];
                let assigned = [];
                
                // Assign based on skills
                stations.forEach((station, idx) => {
                    const qualified = staff.filter(s => s.skills && s.skills.includes(station));
                    if (qualified.length > 0) {
                        const person = qualified[idx % qualified.length];
                        if (!assigned.find(a => a.staff === person.name)) {
                            assigned.push({station, staff: person.name});
                        }
                    }
                });
                
                if (assigned.length > 0) {
                    html += '<tr><td class="time-slot">' + time + '</td>';
                    html += '<td>å²—ä½å€¼ç­</td>';
                    html += '<td>' + assigned.map(a => a.station + ': ' + a.staff).join('<br>') + '</td></tr>';
                }
            }
            
            // Closing
            html += '<tr><td class="time-slot">22:00-22:30</td>';
            html += '<td><span class="badge badge-cleaning">é—­æ¡£æ¸…æ´</span><br>çš®åˆ’è‰‡,æ»‘é›ªæœº,å†²æµªæ¿,ä¿é¾„çƒ</td>';
            html += '<td>' + staff.slice(0, 3).map(s => s.name).join(', ') + '</td></tr>';
            
            html += '</tbody></table>';
            
            // Share link
            html += '<div class="share-box">';
            html += '<h3>ğŸ”— å‘˜å·¥æŸ¥çœ‹é“¾æ¥</h3>';
            html += '<p>å¤åˆ¶æ­¤é“¾æ¥å‘é€ç»™å‘˜å·¥æŸ¥çœ‹ä¸ªäººæ’ç­</p>';
            html += '<input type="text" value="' + window.location.href + '?view=employee&date=' + date + '" readonly onclick="this.select()">';
            html += '</div></div>';
            
            return {date, dayType, morningDuty, eveningDuty, staff: staff.map(s => s.name), html};
        }

        function displaySchedule(schedule) {
            document.getElementById('scheduleOutput').innerHTML = schedule.html;
            document.getElementById('scheduleOutput').scrollIntoView({behavior: 'smooth'});
        }

        function reset() {
            staffStatus = {};
            renderStaff();
            document.getElementById('scheduleOutput').innerHTML = '';
        }

        function showView(view) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(view + 'View').classList.add('active');
        }

        function populateEmployees() {
            const allStaff = [];
            Object.values(staffDB).forEach(g => allStaff.push(...g));
            const select = document.getElementById('employeeSelect');
            select.innerHTML = '<option value="">-- é€‰æ‹©å§“å --</option>' + 
                [...new Set(allStaff)].sort().map(n => '<option value="' + n + '">' + n + '</option>').join('');
        }

        function viewPersonalSchedule() {
            const name = document.getElementById('employeeSelect').value;
            if (!name) { alert('è¯·é€‰æ‹©å§“å'); return; }
            
            const date = document.getElementById('scheduleDate').value;
            const schedule = JSON.parse(localStorage.getItem('schedule_' + date) || '{}');
            
            if (!schedule || !schedule.staff || !schedule.staff.includes(name)) {
                document.getElementById('personalSchedule').innerHTML = '<p style="margin-top:20px;color:#666;">ä»Šæ—¥æš‚æ— æ‚¨çš„æ’ç­ä¿¡æ¯</p>';
                return;
            }
            
            // Generate personal view
            let html = '<div style="margin-top:30px;text-align:left;">';
            html += '<h3>' + name + ' - ' + date + ' æ’ç­</h3>';
            html += '<div class="schedule-item"><div class="schedule-time">9:00-10:00</div><div>å¼€æ¡£æ¸…æ´</div></div>';
            html += '<div class="schedule-item"><div class="schedule-time">10:00-13:30</div><div>å²—ä½å€¼ç­</div></div>';
            html += '<div class="schedule-item"><div class="schedule-time">13:30-14:30</div><div>ä¼‘æ¯/åƒé¥­</div></div>';
            html += '<div class="schedule-item"><div class="schedule-time">14:30-18:00</div><div>å²—ä½å€¼ç­</div></div>';
            html += '<div class="schedule-item"><div class="schedule-time">18:00-22:00</div><div>å²—ä½å€¼ç­</div></div>';
            html += '<div class="schedule-item"><div class="schedule-time">22:00-22:30</div><div>é—­æ¡£æ¸…æ´</div></div>';
            html += '</div>';
            
            document.getElementById('personalSchedule').innerHTML = html;
        }

        // Check URL params for employee view
        if (location.search.includes('view=employee')) {
            showView('employee');
            document.querySelector('.tab.active').classList.remove('active');
            document.querySelectorAll('.tab')[1].classList.add('active');
        }

        init();
    </script>
</body>
</html>
